# Калибровка
Калибровочный скетч предназначен для автоматического определения значений минимального и максимального ШИМ (**MIN_PWM** и **MAX_PWM**).

Калибровка производится на пустом столе. На движение стола влияет много случайных факторов, поэтому рекомендуется запускать скетч несколько раз.
### Что дальше?
Выбранные значения MIN_PWM и MAX_PWM следует поместить в скетч pwm2speed или NC_pwm2speed для определения времени полного оборота стола.

Затем полученные значения надо поместить в функцию getTimeOfTurn() рабочего скетча. Эта функция используется для вычисления скорости движения в безостановочном режиме.

Рекомендуется также запускать скетч autotimes или NC_autotimes. Этот скетч замеряет время осуществления полного цикла в автоматическом режиме в зависимости от количества шагов и ускорения. Если по ходу работы возникают ошибки стола, скетч отображает их. В идеале ошибок быть не должно.
### Рекомендации по выбору MIN_PWM и MAX_PWM
Интервал от MIN_PWM до MAX_PWM должен быть достаточным для нормальной работы стола.

MAX_PWM менее важен, чем MIN_PWM, тем не менее он участвует в вычислениях, в частности, его используют функции accelerate и decelerate, определяющие ускорение и замедление стола. 

Калибровочный скетч определяет MAX_PWM как наибольший ШИМ-сигнал, при котором стол совершает полный оборот без ошибок, то есть точно приходит в заданную точку. Это значение может меняться от запуска к запуску. Если стол вращается слишком быстро, значение MAX_PWM можно уменьшить, это безопасно.

Наибольшее значение для правильной работы стола имеет MIN_PWM. К его выбору надо подходить очень тщательно. Если MIN_PWM слишком мал, нагруженный стол будет с трудом трогаться. В рабочих скетчах предусмотрена функция start(), позволяющая увеличивать минимальный ШИМ, если стол не начинает движение слишком долго. Однако, для увеличения ШИМ предусмотрен верхний предел, который зависит от текущего ускорения и расстояния, на которое надо переместить стол. При слишком малом шаге увеличить ШИМ невозможно, поэтому есть опасность того, что стол не сможет завершить заданное перемещение. Кроме того, стол будет трогаться слишком долго.

С другой стороны, слишком большой MIN_PWM будет приводить к тому, что стол будет часто ошибаться и перескакивать через заданную точку.
### Другие параметры, влияющие на работу стола
1. Функция Settings::getRealAcceleration(), возвращающая количество меток энкодера для ускорения и замедления от MIN_PWM до MAX_PWM и наоборот
2. Функция getFinalDistance(), см. https://github.com/andrey-val-rodin/RotatingTable.Arduino#readme
3. Переменная highestLimit в функции calcHighLimitOfMinPWM(), определяющая лимит увеличения MIN_PWM в функции start()